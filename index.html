<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Crystal Docs 0.34.0">
<meta name="crystal_docs.project_version" content="master">
<meta name="crystal_docs.project_name" content="mochi">


<link href="css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/doc.js"></script>

<svg class="hidden">
  <symbol id="octicon-link" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
  </symbol>
</svg>

  <meta id="repository-name" content="mochi">
  <title>mochi master</title>
  <script type="text/javascript">
  CrystalDocs.base_path = "";
  </script>
</head>
<body>

<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false" aria-label="Search">
    </div>

    <div class="project-summary">
      <h1 class="project-name">
        <a href="index.html">
          mochi
        </a>
      </h1>

      <span class="project-version">
        master
      </span>
    </div>
  </div>

  <div class="search-results" class="hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class=" " data-id="mochi/ApplicationController" data-name="applicationcontroller">
      <a href="ApplicationController.html">ApplicationController</a>
      
    </li>
  
  <li class="parent " data-id="mochi/Mochi" data-name="mochi">
      <a href="Mochi.html">Mochi</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Configuration" data-name="mochi::configuration">
      <a href="Mochi/Configuration.html">Configuration</a>
      
    </li>
  
  <li class="parent " data-id="mochi/Mochi/Controllers" data-name="mochi::controllers">
      <a href="Mochi/Controllers.html">Controllers</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Controllers/Helpers" data-name="mochi::controllers::helpers">
      <a href="Mochi/Controllers/Helpers.html">Helpers</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Controllers/InvitableController" data-name="mochi::controllers::invitablecontroller">
      <a href="Mochi/Controllers/InvitableController.html">InvitableController</a>
      
    </li>
  
  <li class="parent " data-id="mochi/Mochi/Controllers/Omniauthable" data-name="mochi::controllers::omniauthable">
      <a href="Mochi/Controllers/Omniauthable.html">Omniauthable</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Controllers/Omniauthable/SessionController" data-name="mochi::controllers::omniauthable::sessioncontroller">
      <a href="Mochi/Controllers/Omniauthable/SessionController.html">SessionController</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Controllers/Omniauthable/UserController" data-name="mochi::controllers::omniauthable::usercontroller">
      <a href="Mochi/Controllers/Omniauthable/UserController.html">UserController</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Controllers/PasswordController" data-name="mochi::controllers::passwordcontroller">
      <a href="Mochi/Controllers/PasswordController.html">PasswordController</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Controllers/RegistrationController" data-name="mochi::controllers::registrationcontroller">
      <a href="Mochi/Controllers/RegistrationController.html">RegistrationController</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Controllers/SessionController" data-name="mochi::controllers::sessioncontroller">
      <a href="Mochi/Controllers/SessionController.html">SessionController</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Controllers/UnlockController" data-name="mochi::controllers::unlockcontroller">
      <a href="Mochi/Controllers/UnlockController.html">UnlockController</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Controllers/UserController" data-name="mochi::controllers::usercontroller">
      <a href="Mochi/Controllers/UserController.html">UserController</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="mochi/Mochi/DefaultMailer" data-name="mochi::defaultmailer">
      <a href="Mochi/DefaultMailer.html">DefaultMailer</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Mailer" data-name="mochi::mailer">
      <a href="Mochi/Mailer.html">Mailer</a>
      
    </li>
  
  <li class="parent " data-id="mochi/Mochi/Models" data-name="mochi::models">
      <a href="Mochi/Models.html">Models</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Models/Authenticable" data-name="mochi::models::authenticable">
      <a href="Mochi/Models/Authenticable.html">Authenticable</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Models/Confirmable" data-name="mochi::models::confirmable">
      <a href="Mochi/Models/Confirmable.html">Confirmable</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Models/Invitable" data-name="mochi::models::invitable">
      <a href="Mochi/Models/Invitable.html">Invitable</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Models/Lockable" data-name="mochi::models::lockable">
      <a href="Mochi/Models/Lockable.html">Lockable</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Models/Recoverable" data-name="mochi::models::recoverable">
      <a href="Mochi/Models/Recoverable.html">Recoverable</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Models/Trackable" data-name="mochi::models::trackable">
      <a href="Mochi/Models/Trackable.html">Trackable</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="mochi/Mochi/Omniauthable" data-name="mochi::omniauthable">
      <a href="Mochi/Omniauthable.html">Omniauthable</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/Configuration" data-name="mochi::omniauthable::configuration">
      <a href="Mochi/Omniauthable/Configuration.html">Configuration</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/Engine" data-name="mochi::omniauthable::engine">
      <a href="Mochi/Omniauthable/Engine.html">Engine</a>
      
    </li>
  
  <li class="parent " data-id="mochi/Mochi/Omniauthable/Provider" data-name="mochi::omniauthable::provider">
      <a href="Mochi/Omniauthable/Provider.html">Provider</a>
      
        <ul>
  
  <li class="parent " data-id="mochi/Mochi/Omniauthable/Provider/Facebook" data-name="mochi::omniauthable::provider::facebook">
      <a href="Mochi/Omniauthable/Provider/Facebook.html">Facebook</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/Provider/Facebook/FbUser" data-name="mochi::omniauthable::provider::facebook::fbuser">
      <a href="Mochi/Omniauthable/Provider/Facebook/FbUser.html">FbUser</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="mochi/Mochi/Omniauthable/Provider/Github" data-name="mochi::omniauthable::provider::github">
      <a href="Mochi/Omniauthable/Provider/Github.html">Github</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/Provider/Github/GhUser" data-name="mochi::omniauthable::provider::github::ghuser">
      <a href="Mochi/Omniauthable/Provider/Github/GhUser.html">GhUser</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="mochi/Mochi/Omniauthable/Provider/Twitter" data-name="mochi::omniauthable::provider::twitter">
      <a href="Mochi/Omniauthable/Provider/Twitter.html">Twitter</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/Provider/Twitter/TwUser" data-name="mochi::omniauthable::provider::twitter::twuser">
      <a href="Mochi/Omniauthable/Provider/Twitter/TwUser.html">TwUser</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="mochi/Mochi/Omniauthable/Provider/Vk" data-name="mochi::omniauthable::provider::vk">
      <a href="Mochi/Omniauthable/Provider/Vk.html">Vk</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/Provider/Vk/VkResponse" data-name="mochi::omniauthable::provider::vk::vkresponse">
      <a href="Mochi/Omniauthable/Provider/Vk/VkResponse.html">VkResponse</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/Provider/Vk/VkTitle" data-name="mochi::omniauthable::provider::vk::vktitle">
      <a href="Mochi/Omniauthable/Provider/Vk/VkTitle.html">VkTitle</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/Provider/Vk/VkUser" data-name="mochi::omniauthable::provider::vk::vkuser">
      <a href="Mochi/Omniauthable/Provider/Vk/VkUser.html">VkUser</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/ReferenceUser" data-name="mochi::omniauthable::referenceuser">
      <a href="Mochi/Omniauthable/ReferenceUser.html">ReferenceUser</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="mochi/TypeRestrictions" data-name="typerestrictions">
      <a href="TypeRestrictions.html">TypeRestrictions</a>
      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<p>&lt;p align="center">
  &lt;img src="./logo.svg" width="800">
&lt;/p></p>

<p>Mochi is a authentication shard inspired by devise. Mochi is designed for the Amber framework with support for both Granite & Jennifer ORM's.</p>

<h2><a id="installation" class="anchor" href="#installation">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Installation</h2>

<ol><li>Add the dependency to your <code>shard.yml</code>:  </li></ol>

<pre><code><span class="s">``</span><span class="s">`yaml
dependencies:
  mochi:
    github: andrewc910/mochi
    version: ~&gt; 0.3.1
`</span><span class="s">``</span></code></pre>

<ol><li>Run <code>shards install</code></li></ol>

<h3><a id="amber-plugin" class="anchor" href="#amber-plugin">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Amber Plugin</h3>

<ol><li>Install amber plugin:</li></ol>

<ul><li>Granite</li></ul></ul>

<pre><code><span class="s">`amber plugin mochi granite sql`</span></code></pre>

<ul><li>Jennifer</li></ul></ul>

<pre><code><span class="s">`amber plugin mochi jennifer cr`</span></code></pre>

<blockquote>Note: The final argument is stating the file extension for migrations. Amber doesn't support expressions in file names.</blockquote>

<h3><a id="manual" class="anchor" href="#manual">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Manual</h3>

<p><span class="flag orange">TODO</span> </p>

<h2><a id="documentation" class="anchor" href="#documentation">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Documentation</h2>

<h3><a id="api-docs" class="anchor" href="#api-docs">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>API Docs</h3>

<p><a href="https://andrewc910.github.io/mochi/" target="_blank">API Documentation</a></p>

<h2><a id="mochi-modules" class="anchor" href="#mochi-modules">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Mochi Modules</h2>

<blockquote><strong>Note:</strong> Only the class 'User' is supported.</blockquote>

<h3><a id="authenticable" class="anchor" href="#authenticable">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Authenticable</h3>

<p>Authenticatable is responsible for hashing passwords and validating the authenticity of a user while signing in.</p>

<p><strong>Examples:</strong></p>

<pre><code class="language-crystal">user <span class="o">=</span> <span class="t">User</span>.<span class="k">new</span>({email: <span class="s">&quot;demo@email.com&quot;</span>})
user.password <span class="o">=</span> <span class="s">&quot;password&quot;</span>       <span class="c"># =&gt; sets &amp; returns password_digest</span>
user.password_changed?           <span class="c"># =&gt; true</span>
user.password_to_short?          <span class="c"># =&gt; false</span>
user.valid_password?(<span class="s">&quot;Password&quot;</span>) <span class="c"># =&gt; false</span>
user.valid_password?(<span class="s">&quot;password&quot;</span>) <span class="c"># =&gt; true</span></code></pre>

<h3><a id="confirmable" class="anchor" href="#confirmable">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Confirmable</h3>

<p>Confirmable is responsible to verify if an account is already confirmed to sign in, and to send emails with confirmation instructions. Confirmation instructions are sent to the user email after creating a record and when manually requested by a new confirmation instruction request.</p>

<p><strong>Examples:</strong></p>

<pre><code class="language-crystal">user <span class="o">=</span> <span class="t">User</span>.<span class="k">new</span>({email: <span class="s">&quot;demo@email.com&quot;</span>})
user.confirm                        <span class="c"># returns true unless it&#39;s already confirmed</span>
user.confirmed?                     <span class="c"># true/false</span>
user.send_confirmation_instructions <span class="c"># manually send instructions</span></code></pre>

<h3><a id="invitable" class="anchor" href="#invitable">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Invitable</h3>

<p>Invitable is responsible for sending invitation emails. When an invitation is sent to an email address, an account is created for it. Invitation email contains a link allowing the user to accept the invitation by setting a password.</p>

<p><strong>Examples:</strong></p>

<pre><code class="language-crystal">user <span class="o">=</span> <span class="t">User</span>.<span class="k">new</span>({email: <span class="s">&quot;demo@email.com&quot;</span>})
user.invited_to_sign_up? <span class="c"># =&gt; false</span>
user.invite!             <span class="c"># =&gt; send invitation</span>
user.accept_invitation!  <span class="c"># =&gt; accept invitation with a token</span>
user.accept_invitation!  <span class="c"># =&gt; accept invitation</span>
user.invited_to_sign_up? <span class="c"># =&gt; true</span>
user.invite!             <span class="c"># =&gt; reset invitation status and send invitation again</span></code></pre>

<h3><a id="lockable" class="anchor" href="#lockable">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Lockable</h3>

<p>Lockable is responsible blocking a user access after a certain number of attempts and unlocking the account after a certain amount of time or the user resetting their password.</p>

<p><strong>Examples:</strong></p>

<pre><code class="language-crystal"><span class="t">Mochi</span>.configuration.maximum_attempts <span class="o">=</span> <span class="n">2</span>

user <span class="o">=</span> <span class="t">User</span>.<span class="k">new</span>({email: <span class="s">&quot;demo@email.com&quot;</span>})
user.increment_failed_attempts! <span class="c"># =&gt; 1</span>
user.last_attempt?              <span class="c"># =&gt; true</span>
user.attempts_exceeded?         <span class="c"># =&gt; false</span>

user.increment_failed_attempts! <span class="c"># =&gt; 2</span>
user.attempts_exceeded?         <span class="c"># =&gt; true</span>
user.lock_access!               <span class="c"># =&gt; true</span>

user.access_locked?             <span class="c"># =&gt; true</span>
user.valid_for_authentication?  <span class="c"># =&gt; false</span>

user.unlock_access!             <span class="c"># =&gt; true</span>
user.access_locked?             <span class="c"># =&gt; false</span>
user.valid_for_authentication?  <span class="c"># =&gt; true</span></code></pre>

<h3><a id="recoverable" class="anchor" href="#recoverable">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Recoverable</h3>

<p>Recoverable takes care of resetting the user password and send reset instructions.</p>

<p><strong>Examples:</strong></p>

<pre><code class="language-crystal">user <span class="o">=</span> <span class="t">User</span>.<span class="k">new</span>({email: <span class="s">&quot;demo@email.com&quot;</span>})
<span class="c"># resets the user password and save the record, `true` if valid passwords are given, otherwise false</span>
user.reset_password(<span class="s">&quot;password123&quot;</span>) <span class="c"># =&gt; true</span>

<span class="c"># creates a new token and send it with instructions about how to reset the password</span>
user.send_reset_password_instructions <span class="c"># =&gt; true</span></code></pre>

<h3><a id="trackable" class="anchor" href="#trackable">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Trackable</h3>

<p>Tracks information about your user sign in events.</p>

<p><strong>Examples:</strong></p>

<pre><code class="language-crystal">request <span class="o">=</span> <span class="t">Http</span><span class="t">::</span><span class="t">Request</span>.<span class="k">new</span>

user <span class="o">=</span> <span class="t">User</span>.<span class="k">new</span>({email: <span class="s">&quot;demo@email.com&quot;</span>})
<span class="c"># Updates last_sign_in_at,</span>
<span class="c">#         current_sign_in_at,</span>
<span class="c">#         last_sign_in_ip,</span>
<span class="c">#         current_sign_in_ip,</span>
<span class="c">#         sign_in_count</span>
<span class="c"># and saves the record</span>
user.update_tracked_fields!(request) <span class="c"># =&gt; true</span></code></pre>

<h3><a id="omniauthable" class="anchor" href="#omniauthable">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Omniauthable</h3>

<p><strong>Examples:</strong></p>

<pre><code class="language-crystal">user <span class="o">=</span> <span class="t">User</span>.<span class="k">new</span>({email: <span class="s">&quot;demo@email.com&quot;</span>})
<span class="c"># TODO</span></code></pre>

<h2><a id="mochi-controllers" class="anchor" href="#mochi-controllers">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Mochi Controllers</h2>

<p>As stated above, Mochi is specifically designed for Amber. Default controllers are available. To view the available controllers, <a href="https://github.com/andrewc910/mochi/tree/master/src/mochi/controllers" target="_blank">please look here</a>. If you install via the plugin method, these will be used by default. You are welcome to copy/paste the code into a custom controller for modification if you need to. It's not recommended to edit plugin files directly. If you install an update, you may accidently overwrite your changes with the incoming ones.</p>

<h2><a id="amber-framework-plugin" class="anchor" href="#amber-framework-plugin">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Amber Framework Plugin</h2>

<p>Mochi can be installed via the Amber framework CLI. This will install the <code>User</code> model, controllers, mailers, routes, plugs & the initializer. Unfortunately, Amber's plugin cli is an all or nothing. Because of this, when you run the plugin installer, all files for all modules will be installed. However, Mochi installs with only authentication activated. You will have to uncomment any other modules/columns/routes you would like activated or delete files/commented code you do not want or need.</p>

<h2><a id="testing" class="anchor" href="#testing">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Testing</h2>

<p>All specs use Postgres as the database.</p>

<ol><li>Create a user <code>mochi</code> with a password of <code>mochi</code>.</li><li>Run the migrations: <code>crystal spec/sam.cr db:setup</code></li><li>Run the specs</li></ol>

<h2><a id="contributing" class="anchor" href="#contributing">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Contributing</h2>

<ol><li>Fork it (&lt;https://github.com/andrewc910/mochi/fork>)</li><li>Create your feature branch (<code>git checkout -b my-new-feature</code>)</li><li>Commit your changes (<code>git commit -am 'Add some feature'</code>)</li><li>Push to the branch (<code>git push origin my-new-feature</code>)</li><li>Create a new Pull Request</li></ol>

<h2><a id="contributors" class="anchor" href="#contributors">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Contributors</h2>

<ul><li><a href="https://github.com/andrewc910" target="_blank">andrewc910</a> - creator and maintainer</li></ul>
</div>
</body>
</html>
