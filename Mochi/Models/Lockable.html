<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Crystal Docs 0.34.0">
<meta name="crystal_docs.project_version" content="master">
<meta name="crystal_docs.project_name" content="mochi">


<link href="../../css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="../../js/doc.js"></script>

<svg class="hidden">
  <symbol id="octicon-link" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
  </symbol>
</svg>

  <meta id="repository-name" content="mochi">
  <title>Mochi::Models::Lockable - mochi master</title>
  <script type="text/javascript">
    CrystalDocs.base_path = "../../";
  </script>
</head>
<body>

<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false" aria-label="Search">
    </div>

    <div class="project-summary">
      <h1 class="project-name">
        <a href="../../index.html">
          mochi
        </a>
      </h1>

      <span class="project-version">
        master
      </span>
    </div>
  </div>

  <div class="search-results" class="hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class=" " data-id="mochi/ApplicationController" data-name="applicationcontroller">
      <a href="../../ApplicationController.html">ApplicationController</a>
      
    </li>
  
  <li class="parent open current" data-id="mochi/Mochi" data-name="mochi">
      <a href="../../Mochi.html">Mochi</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Configuration" data-name="mochi::configuration">
      <a href="../../Mochi/Configuration.html">Configuration</a>
      
    </li>
  
  <li class="parent " data-id="mochi/Mochi/Controllers" data-name="mochi::controllers">
      <a href="../../Mochi/Controllers.html">Controllers</a>
      
        <ul>
  
  <li class="parent " data-id="mochi/Mochi/Controllers/Helpers" data-name="mochi::controllers::helpers">
      <a href="../../Mochi/Controllers/Helpers.html">Helpers</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Controllers/Helpers/TypeRestrictions" data-name="mochi::controllers::helpers::typerestrictions">
      <a href="../../Mochi/Controllers/Helpers/TypeRestrictions.html">TypeRestrictions</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Controllers/InvitableController" data-name="mochi::controllers::invitablecontroller">
      <a href="../../Mochi/Controllers/InvitableController.html">InvitableController</a>
      
    </li>
  
  <li class="parent " data-id="mochi/Mochi/Controllers/Omniauthable" data-name="mochi::controllers::omniauthable">
      <a href="../../Mochi/Controllers/Omniauthable.html">Omniauthable</a>
      
        <ul>
  
  <li class="parent " data-id="mochi/Mochi/Controllers/Omniauthable/Granite" data-name="mochi::controllers::omniauthable::granite">
      <a href="../../Mochi/Controllers/Omniauthable/Granite.html">Granite</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Controllers/Omniauthable/Granite/SessionController" data-name="mochi::controllers::omniauthable::granite::sessioncontroller">
      <a href="../../Mochi/Controllers/Omniauthable/Granite/SessionController.html">SessionController</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="mochi/Mochi/Controllers/Omniauthable/Jennifer" data-name="mochi::controllers::omniauthable::jennifer">
      <a href="../../Mochi/Controllers/Omniauthable/Jennifer.html">Jennifer</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Controllers/Omniauthable/Jennifer/SessionController" data-name="mochi::controllers::omniauthable::jennifer::sessioncontroller">
      <a href="../../Mochi/Controllers/Omniauthable/Jennifer/SessionController.html">SessionController</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Controllers/Omniauthable/UserController" data-name="mochi::controllers::omniauthable::usercontroller">
      <a href="../../Mochi/Controllers/Omniauthable/UserController.html">UserController</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Controllers/PasswordController" data-name="mochi::controllers::passwordcontroller">
      <a href="../../Mochi/Controllers/PasswordController.html">PasswordController</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Controllers/RegistrationController" data-name="mochi::controllers::registrationcontroller">
      <a href="../../Mochi/Controllers/RegistrationController.html">RegistrationController</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Controllers/SessionController" data-name="mochi::controllers::sessioncontroller">
      <a href="../../Mochi/Controllers/SessionController.html">SessionController</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Controllers/UnlockController" data-name="mochi::controllers::unlockcontroller">
      <a href="../../Mochi/Controllers/UnlockController.html">UnlockController</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Controllers/UserController" data-name="mochi::controllers::usercontroller">
      <a href="../../Mochi/Controllers/UserController.html">UserController</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="mochi/Mochi/DefaultMailer" data-name="mochi::defaultmailer">
      <a href="../../Mochi/DefaultMailer.html">DefaultMailer</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Mailer" data-name="mochi::mailer">
      <a href="../../Mochi/Mailer.html">Mailer</a>
      
    </li>
  
  <li class="parent open current" data-id="mochi/Mochi/Models" data-name="mochi::models">
      <a href="../../Mochi/Models.html">Models</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Models/Authenticable" data-name="mochi::models::authenticable">
      <a href="../../Mochi/Models/Authenticable.html">Authenticable</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Models/Confirmable" data-name="mochi::models::confirmable">
      <a href="../../Mochi/Models/Confirmable.html">Confirmable</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Models/Invitable" data-name="mochi::models::invitable">
      <a href="../../Mochi/Models/Invitable.html">Invitable</a>
      
    </li>
  
  <li class=" current" data-id="mochi/Mochi/Models/Lockable" data-name="mochi::models::lockable">
      <a href="../../Mochi/Models/Lockable.html">Lockable</a>
      
    </li>
  
  <li class="parent " data-id="mochi/Mochi/Models/Query" data-name="mochi::models::query">
      <a href="../../Mochi/Models/Query.html">Query</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Models/Query/Granite" data-name="mochi::models::query::granite">
      <a href="../../Mochi/Models/Query/Granite.html">Granite</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Models/Query/Jennifer" data-name="mochi::models::query::jennifer">
      <a href="../../Mochi/Models/Query/Jennifer.html">Jennifer</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Models/Recoverable" data-name="mochi::models::recoverable">
      <a href="../../Mochi/Models/Recoverable.html">Recoverable</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Models/Trackable" data-name="mochi::models::trackable">
      <a href="../../Mochi/Models/Trackable.html">Trackable</a>
      
    </li>
  
  <li class="parent " data-id="mochi/Mochi/Models/Validations" data-name="mochi::models::validations">
      <a href="../../Mochi/Models/Validations.html">Validations</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Models/Validations/Granite" data-name="mochi::models::validations::granite">
      <a href="../../Mochi/Models/Validations/Granite.html">Granite</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Models/Validations/Jennifer" data-name="mochi::models::validations::jennifer">
      <a href="../../Mochi/Models/Validations/Jennifer.html">Jennifer</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="mochi/Mochi/Omniauthable" data-name="mochi::omniauthable">
      <a href="../../Mochi/Omniauthable.html">Omniauthable</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/Configuration" data-name="mochi::omniauthable::configuration">
      <a href="../../Mochi/Omniauthable/Configuration.html">Configuration</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/Engine" data-name="mochi::omniauthable::engine">
      <a href="../../Mochi/Omniauthable/Engine.html">Engine</a>
      
    </li>
  
  <li class="parent " data-id="mochi/Mochi/Omniauthable/Provider" data-name="mochi::omniauthable::provider">
      <a href="../../Mochi/Omniauthable/Provider.html">Provider</a>
      
        <ul>
  
  <li class="parent " data-id="mochi/Mochi/Omniauthable/Provider/Facebook" data-name="mochi::omniauthable::provider::facebook">
      <a href="../../Mochi/Omniauthable/Provider/Facebook.html">Facebook</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/Provider/Facebook/FbUser" data-name="mochi::omniauthable::provider::facebook::fbuser">
      <a href="../../Mochi/Omniauthable/Provider/Facebook/FbUser.html">FbUser</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="mochi/Mochi/Omniauthable/Provider/Github" data-name="mochi::omniauthable::provider::github">
      <a href="../../Mochi/Omniauthable/Provider/Github.html">Github</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/Provider/Github/GhUser" data-name="mochi::omniauthable::provider::github::ghuser">
      <a href="../../Mochi/Omniauthable/Provider/Github/GhUser.html">GhUser</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="mochi/Mochi/Omniauthable/Provider/Twitter" data-name="mochi::omniauthable::provider::twitter">
      <a href="../../Mochi/Omniauthable/Provider/Twitter.html">Twitter</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/Provider/Twitter/TwUser" data-name="mochi::omniauthable::provider::twitter::twuser">
      <a href="../../Mochi/Omniauthable/Provider/Twitter/TwUser.html">TwUser</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="mochi/Mochi/Omniauthable/Provider/Vk" data-name="mochi::omniauthable::provider::vk">
      <a href="../../Mochi/Omniauthable/Provider/Vk.html">Vk</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/Provider/Vk/VkResponse" data-name="mochi::omniauthable::provider::vk::vkresponse">
      <a href="../../Mochi/Omniauthable/Provider/Vk/VkResponse.html">VkResponse</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/Provider/Vk/VkTitle" data-name="mochi::omniauthable::provider::vk::vktitle">
      <a href="../../Mochi/Omniauthable/Provider/Vk/VkTitle.html">VkTitle</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/Provider/Vk/VkUser" data-name="mochi::omniauthable::provider::vk::vkuser">
      <a href="../../Mochi/Omniauthable/Provider/Vk/VkUser.html">VkUser</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/ReferenceUser" data-name="mochi::omniauthable::referenceuser">
      <a href="../../Mochi/Omniauthable/ReferenceUser.html">ReferenceUser</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<h1 class="type-name">

  <span class="kind">module</span> Mochi::Models::Lockable

</h1>





  <h2>
    <a id="overview" class="anchor" href="#overview">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>
    Overview
  </h2>

  <p>Handles blocking a user access after a certain number of attempts.
Lockable accepts two different strategies to unlock a user after it's
blocked: email and time. The former will send an email to the user when
the lock happens, containing a link to unlock its account. The second
will unlock the user automatically after some configured time (ie 2.hours).
It's also possible to set up lockable to use both email and time strategies.</p>

<p>Options</p>

<p>Lockable adds the following options to +devise+:</p>

<ul><li><code>maximum_attempts</code>: how many attempts should be accepted before blocking the user.</li><li><code>unlock_in</code>: the time you want to lock the user after to lock happens. Only available when unlock_strategy is :time or :both.</li><li><code>last_attempt_warning</code>: The message users recieve when they are on their final login attempt - WIP</li></ul></ul>














  <h2>
    <a id="defined-in" class="anchor" href="#defined-in">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>
    Defined in:
  </h2>
  
    
      <a href="https://github.com/andrewc910/mochi/blob/bfbe94a628a6459f747ddca8b5cee2f2db8ec6d4/src/mochi/models/lockable.cr#L20" target="_blank">
        mochi/models/lockable.cr
      </a>
    
    <br/>
  









  <h2>
    <a id="instance-method-summary" class="anchor" href="#instance-method-summary">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>
    Instance Method Summary
  </h2>
  <ul class="list-summary">
    
      <li class="entry-summary">
        <a href="#access_locked?-instance-method" class="signature"><strong>#access_locked?</strong></a>
        
          <div class="summary"><p>Verifies whether a user is locked or not.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#attempts_exceeded?-instance-method" class="signature"><strong>#attempts_exceeded?</strong></a>
        
      </li>
    
      <li class="entry-summary">
        <a href="#increment_failed_attempts!-instance-method" class="signature"><strong>#increment_failed_attempts!</strong></a>
        
      </li>
    
      <li class="entry-summary">
        <a href="#last_attempt?-instance-method" class="signature"><strong>#last_attempt?</strong></a>
        
      </li>
    
      <li class="entry-summary">
        <a href="#lock_access!(skip_email:Bool=false)-instance-method" class="signature"><strong>#lock_access!</strong>(skip_email : Bool = <span class="n">false</span>)</a>
        
          <div class="summary"><p>Lock a user setting its locked_at to actual time.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#resend_unlock_instructions-instance-method" class="signature"><strong>#resend_unlock_instructions</strong></a>
        
          <div class="summary"><p>Resend the unlock instructions if the user is locked.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#send_unlock_instructions-instance-method" class="signature"><strong>#send_unlock_instructions</strong></a>
        
          <div class="summary"><p>Send unlock instructions by email</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#unlock_access!-instance-method" class="signature"><strong>#unlock_access!</strong></a>
        
          <div class="summary"><p>Unlock a user by cleaning locked_at and failed_attempts.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#valid_for_authentication?-instance-method" class="signature"><strong>#valid_for_authentication?</strong></a>
        
          <div class="summary"><p>Overwrites valid_for_authentication? from Devise::Models::Authenticatable for verifying whether a user is allowed to sign in or not.</p></div>
        
      </li>
    
  </ul>





<div class="methods-inherited">
  
</div>






  <h2>
    <a id="instance-method-detail" class="anchor" href="#instance-method-detail">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>
    Instance Method Detail
  </h2>
  
    <div class="entry-detail" id="access_locked?-instance-method">
      <div class="signature">
        
        def <strong>access_locked?</strong>

        <a class="method-permalink" href="#access_locked?-instance-method">#</a>
      </div>
      
        <div class="doc">
          
          <p>Verifies whether a user is locked or not.</p>
        </div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/andrewc910/mochi/blob/bfbe94a628a6459f747ddca8b5cee2f2db8ec6d4/src/mochi/models/lockable.cr#L43" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="attempts_exceeded?-instance-method">
      <div class="signature">
        
        def <strong>attempts_exceeded?</strong>

        <a class="method-permalink" href="#attempts_exceeded?-instance-method">#</a>
      </div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/andrewc910/mochi/blob/bfbe94a628a6459f747ddca8b5cee2f2db8ec6d4/src/mochi/models/lockable.cr#L92" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="increment_failed_attempts!-instance-method">
      <div class="signature">
        
        def <strong>increment_failed_attempts!</strong>

        <a class="method-permalink" href="#increment_failed_attempts!-instance-method">#</a>
      </div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/andrewc910/mochi/blob/bfbe94a628a6459f747ddca8b5cee2f2db8ec6d4/src/mochi/models/lockable.cr#L73" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="last_attempt?-instance-method">
      <div class="signature">
        
        def <strong>last_attempt?</strong>

        <a class="method-permalink" href="#last_attempt?-instance-method">#</a>
      </div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/andrewc910/mochi/blob/bfbe94a628a6459f747ddca8b5cee2f2db8ec6d4/src/mochi/models/lockable.cr#L96" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="lock_access!(skip_email:Bool=false)-instance-method">
      <div class="signature">
        
        def <strong>lock_access!</strong>(skip_email : Bool = <span class="n">false</span>)

        <a class="method-permalink" href="#lock_access!(skip_email:Bool=false)-instance-method">#</a>
      </div>
      
        <div class="doc">
          
          <p>Lock a user setting its locked_at to actual time.
  when you lock access, you could pass the
  <code>skip_email: true</code> as an option.</p>
        </div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/andrewc910/mochi/blob/bfbe94a628a6459f747ddca8b5cee2f2db8ec6d4/src/mochi/models/lockable.cr#L24" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="resend_unlock_instructions-instance-method">
      <div class="signature">
        
        def <strong>resend_unlock_instructions</strong>

        <a class="method-permalink" href="#resend_unlock_instructions-instance-method">#</a>
      </div>
      
        <div class="doc">
          
          <p>Resend the unlock instructions if the user is locked.</p>
        </div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/andrewc910/mochi/blob/bfbe94a628a6459f747ddca8b5cee2f2db8ec6d4/src/mochi/models/lockable.cr#L57" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="send_unlock_instructions-instance-method">
      <div class="signature">
        
        def <strong>send_unlock_instructions</strong>

        <a class="method-permalink" href="#send_unlock_instructions-instance-method">#</a>
      </div>
      
        <div class="doc">
          
          <p>Send unlock instructions by email</p>
        </div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/andrewc910/mochi/blob/bfbe94a628a6459f747ddca8b5cee2f2db8ec6d4/src/mochi/models/lockable.cr#L48" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="unlock_access!-instance-method">
      <div class="signature">
        
        def <strong>unlock_access!</strong>

        <a class="method-permalink" href="#unlock_access!-instance-method">#</a>
      </div>
      
        <div class="doc">
          
          <p>Unlock a user by cleaning locked_at and failed_attempts.</p>
        </div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/andrewc910/mochi/blob/bfbe94a628a6459f747ddca8b5cee2f2db8ec6d4/src/mochi/models/lockable.cr#L35" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="valid_for_authentication?-instance-method">
      <div class="signature">
        
        def <strong>valid_for_authentication?</strong>

        <a class="method-permalink" href="#valid_for_authentication?-instance-method">#</a>
      </div>
      
        <div class="doc">
          
          <p>Overwrites valid_for_authentication? from Devise::Models::Authenticatable
for verifying whether a user is allowed to sign in or not. If the user
is locked, it should never be allowed.</p>
        </div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/andrewc910/mochi/blob/bfbe94a628a6459f747ddca8b5cee2f2db8ec6d4/src/mochi/models/lockable.cr#L64" target="_blank">View source</a>]
        
      </div>
    </div>
  




</div>

</body>
</html>
