<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Crystal Docs 0.34.0">
<meta name="crystal_docs.project_version" content="master">
<meta name="crystal_docs.project_name" content="mochi">


<link href="../../css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="../../js/doc.js"></script>

<svg class="hidden">
  <symbol id="octicon-link" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
  </symbol>
</svg>

  <meta id="repository-name" content="mochi">
  <title>Mochi::Models::Confirmable - mochi master</title>
  <script type="text/javascript">
    CrystalDocs.base_path = "../../";
  </script>
</head>
<body>

<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false" aria-label="Search">
    </div>

    <div class="project-summary">
      <h1 class="project-name">
        <a href="../../index.html">
          mochi
        </a>
      </h1>

      <span class="project-version">
        master
      </span>
    </div>
  </div>

  <div class="search-results" class="hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class=" " data-id="mochi/ApplicationController" data-name="applicationcontroller">
      <a href="../../ApplicationController.html">ApplicationController</a>
      
    </li>
  
  <li class="parent open current" data-id="mochi/Mochi" data-name="mochi">
      <a href="../../Mochi.html">Mochi</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Configuration" data-name="mochi::configuration">
      <a href="../../Mochi/Configuration.html">Configuration</a>
      
    </li>
  
  <li class="parent " data-id="mochi/Mochi/Controllers" data-name="mochi::controllers">
      <a href="../../Mochi/Controllers.html">Controllers</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Controllers/Helpers" data-name="mochi::controllers::helpers">
      <a href="../../Mochi/Controllers/Helpers.html">Helpers</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Controllers/InvitableController" data-name="mochi::controllers::invitablecontroller">
      <a href="../../Mochi/Controllers/InvitableController.html">InvitableController</a>
      
    </li>
  
  <li class="parent " data-id="mochi/Mochi/Controllers/Omniauthable" data-name="mochi::controllers::omniauthable">
      <a href="../../Mochi/Controllers/Omniauthable.html">Omniauthable</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Controllers/Omniauthable/SessionController" data-name="mochi::controllers::omniauthable::sessioncontroller">
      <a href="../../Mochi/Controllers/Omniauthable/SessionController.html">SessionController</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Controllers/Omniauthable/UserController" data-name="mochi::controllers::omniauthable::usercontroller">
      <a href="../../Mochi/Controllers/Omniauthable/UserController.html">UserController</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Controllers/PasswordController" data-name="mochi::controllers::passwordcontroller">
      <a href="../../Mochi/Controllers/PasswordController.html">PasswordController</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Controllers/RegistrationController" data-name="mochi::controllers::registrationcontroller">
      <a href="../../Mochi/Controllers/RegistrationController.html">RegistrationController</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Controllers/SessionController" data-name="mochi::controllers::sessioncontroller">
      <a href="../../Mochi/Controllers/SessionController.html">SessionController</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Controllers/UnlockController" data-name="mochi::controllers::unlockcontroller">
      <a href="../../Mochi/Controllers/UnlockController.html">UnlockController</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Controllers/UserController" data-name="mochi::controllers::usercontroller">
      <a href="../../Mochi/Controllers/UserController.html">UserController</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="mochi/Mochi/DefaultMailer" data-name="mochi::defaultmailer">
      <a href="../../Mochi/DefaultMailer.html">DefaultMailer</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Mailer" data-name="mochi::mailer">
      <a href="../../Mochi/Mailer.html">Mailer</a>
      
    </li>
  
  <li class="parent open current" data-id="mochi/Mochi/Models" data-name="mochi::models">
      <a href="../../Mochi/Models.html">Models</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Models/Authenticable" data-name="mochi::models::authenticable">
      <a href="../../Mochi/Models/Authenticable.html">Authenticable</a>
      
    </li>
  
  <li class=" current" data-id="mochi/Mochi/Models/Confirmable" data-name="mochi::models::confirmable">
      <a href="../../Mochi/Models/Confirmable.html">Confirmable</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Models/Invitable" data-name="mochi::models::invitable">
      <a href="../../Mochi/Models/Invitable.html">Invitable</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Models/Lockable" data-name="mochi::models::lockable">
      <a href="../../Mochi/Models/Lockable.html">Lockable</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Models/Recoverable" data-name="mochi::models::recoverable">
      <a href="../../Mochi/Models/Recoverable.html">Recoverable</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Models/Trackable" data-name="mochi::models::trackable">
      <a href="../../Mochi/Models/Trackable.html">Trackable</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="mochi/Mochi/Omniauthable" data-name="mochi::omniauthable">
      <a href="../../Mochi/Omniauthable.html">Omniauthable</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/Configuration" data-name="mochi::omniauthable::configuration">
      <a href="../../Mochi/Omniauthable/Configuration.html">Configuration</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/Engine" data-name="mochi::omniauthable::engine">
      <a href="../../Mochi/Omniauthable/Engine.html">Engine</a>
      
    </li>
  
  <li class="parent " data-id="mochi/Mochi/Omniauthable/Provider" data-name="mochi::omniauthable::provider">
      <a href="../../Mochi/Omniauthable/Provider.html">Provider</a>
      
        <ul>
  
  <li class="parent " data-id="mochi/Mochi/Omniauthable/Provider/Facebook" data-name="mochi::omniauthable::provider::facebook">
      <a href="../../Mochi/Omniauthable/Provider/Facebook.html">Facebook</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/Provider/Facebook/FbUser" data-name="mochi::omniauthable::provider::facebook::fbuser">
      <a href="../../Mochi/Omniauthable/Provider/Facebook/FbUser.html">FbUser</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="mochi/Mochi/Omniauthable/Provider/Github" data-name="mochi::omniauthable::provider::github">
      <a href="../../Mochi/Omniauthable/Provider/Github.html">Github</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/Provider/Github/GhUser" data-name="mochi::omniauthable::provider::github::ghuser">
      <a href="../../Mochi/Omniauthable/Provider/Github/GhUser.html">GhUser</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="mochi/Mochi/Omniauthable/Provider/Twitter" data-name="mochi::omniauthable::provider::twitter">
      <a href="../../Mochi/Omniauthable/Provider/Twitter.html">Twitter</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/Provider/Twitter/TwUser" data-name="mochi::omniauthable::provider::twitter::twuser">
      <a href="../../Mochi/Omniauthable/Provider/Twitter/TwUser.html">TwUser</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="mochi/Mochi/Omniauthable/Provider/Vk" data-name="mochi::omniauthable::provider::vk">
      <a href="../../Mochi/Omniauthable/Provider/Vk.html">Vk</a>
      
        <ul>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/Provider/Vk/VkResponse" data-name="mochi::omniauthable::provider::vk::vkresponse">
      <a href="../../Mochi/Omniauthable/Provider/Vk/VkResponse.html">VkResponse</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/Provider/Vk/VkTitle" data-name="mochi::omniauthable::provider::vk::vktitle">
      <a href="../../Mochi/Omniauthable/Provider/Vk/VkTitle.html">VkTitle</a>
      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/Provider/Vk/VkUser" data-name="mochi::omniauthable::provider::vk::vkuser">
      <a href="../../Mochi/Omniauthable/Provider/Vk/VkUser.html">VkUser</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="mochi/Mochi/Omniauthable/ReferenceUser" data-name="mochi::omniauthable::referenceuser">
      <a href="../../Mochi/Omniauthable/ReferenceUser.html">ReferenceUser</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="mochi/TypeRestrictions" data-name="typerestrictions">
      <a href="../../TypeRestrictions.html">TypeRestrictions</a>
      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<h1 class="type-name">

  <span class="kind">module</span> Mochi::Models::Confirmable

</h1>





  <h2>
    <a id="overview" class="anchor" href="#overview">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>
    Overview
  </h2>

  <p>Confirmable is responsible to verify if an account is already confirmed to
sign in, and to send emails with confirmation instructions.
Confirmation instructions are sent to the user email after creating a
record and when manually requested by a new confirmation instruction request.</p>

<p>Columns:</p>

<ul><li><code>confirmation_token : String</code> - Token used for email activation & verification</li><li><code>confirmed : Bool</code> - True if user account is activated</li><li><code>confirmed_at : Timestamp?</code> - Time user confirmed account</li><li><code>confirmation_sent_at : Timestamp?</code> - Time confirmation email sent</li><li><code>unconfirmed_email : String?</code> - An email address copied from the email attr after confirmation.</li></ul>

<p>Configuration:</p>

<ul><li><code>allow_unconfirmed_access_for</code> - the time you want to allow the user to access their account before confirming it. After this period, the user access is denied. You can use this to let your user access some features of your application without confirming the account, but blocking it after a certain period (ie 7 days). By default <code>allow_unconfirmed_access_for</code> is zero, it means users always have to confirm to sign in.</li></ul>

<ul><li><code>reconfirmable</code> - requires any email changes to be confirmed (exactly the same way as initial account confirmation) to be applied. Requires additional unconfirmed_email db field to be set up (t.reconfirmable in migrations). Until confirmed, new email is stored in unconfirmed email column, and copied to email column on successful confirmation. Also, when used in conjunction with <code>send_email_changed_notification</code>, the notification is sent to the original email when the change is requested,  not when the unconfirmed email is confirmed.</li></ul>

<ul><li><code>confirm_within</code> - the time before a sent confirmation token becomes invalid. You can use this to force the user to confirm within a set period of time. Confirmable will not generate a new token if a repeat confirmation is requested during this time frame, unless the user's email changed too.</li></ul>

<p>Examples:</p>

<pre><code>user <span class="o">=</span> <span class="t">User</span>.<span class="k">new</span>({email: <span class="s">&quot;demo@email.com&quot;</span>})
user.confirm                        <span class="c"># returns true unless it&#39;s already confirmed</span>
user.confirmed?                     <span class="c"># true/false</span>
user.send_confirmation_instructions <span class="c"># manually send instructions</span></code></pre>














  <h2>
    <a id="defined-in" class="anchor" href="#defined-in">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>
    Defined in:
  </h2>
  
    
      <a href="https://github.com/andrewc910/mochi/blob/c02c7cf7b0f28c85466d284070322ab6baa2cd15/src/mochi/models/confirmable.cr#L34" target="_blank">
        mochi/models/confirmable.cr
      </a>
    
    <br/>
  









  <h2>
    <a id="instance-method-summary" class="anchor" href="#instance-method-summary">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>
    Instance Method Summary
  </h2>
  <ul class="list-summary">
    
      <li class="entry-summary">
        <a href="#confirm-instance-method" class="signature"><strong>#confirm</strong></a>
        
      </li>
    
      <li class="entry-summary">
        <a href="#confirm!-instance-method" class="signature"><strong>#confirm!</strong></a>
        
          <div class="summary"><p>Confirm a user by setting it's confirmed_at to actual time.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#confirmation_period_valid?-instance-method" class="signature"><strong>#confirmation_period_valid?</strong></a>
        
          <div class="summary"><p>Checks if the confirmation for the user is within the limit time.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#confirmation_required?-instance-method" class="signature"><strong>#confirmation_required?</strong></a>
        
      </li>
    
      <li class="entry-summary">
        <a href="#confirmed?-instance-method" class="signature"><strong>#confirmed?</strong></a>
        
      </li>
    
      <li class="entry-summary">
        <a href="#generate_confirmation_token-instance-method" class="signature"><strong>#generate_confirmation_token</strong></a>
        
          <div class="summary"><p>Generates a new random token for confirmation, and stores the value in <code>self.confirmation_token</code></p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#generate_confirmation_token!-instance-method" class="signature"><strong>#generate_confirmation_token!</strong></a>
        
          <div class="summary"><p>Generates a new random token for confirmation, stores the value in <code>self.confirmation_token</code> & then saves the user</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#send_confirmation_instructions-instance-method" class="signature"><strong>#send_confirmation_instructions</strong></a>
        
          <div class="summary"><p>Send a confirmation email.</p></div>
        
      </li>
    
  </ul>





<div class="methods-inherited">
  
</div>






  <h2>
    <a id="instance-method-detail" class="anchor" href="#instance-method-detail">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>
    Instance Method Detail
  </h2>
  
    <div class="entry-detail" id="confirm-instance-method">
      <div class="signature">
        
        def <strong>confirm</strong>

        <a class="method-permalink" href="#confirm-instance-method">#</a>
      </div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/andrewc910/mochi/blob/c02c7cf7b0f28c85466d284070322ab6baa2cd15/src/mochi/models/confirmable.cr#L77" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="confirm!-instance-method">
      <div class="signature">
        
        def <strong>confirm!</strong>

        <a class="method-permalink" href="#confirm!-instance-method">#</a>
      </div>
      
        <div class="doc">
          
          <p>Confirm a user by setting it's confirmed_at to actual time. If the user
is already confirmed, add an error to email field. If the user is invalid
add errors. Saves the user once complete.</p>
        </div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/andrewc910/mochi/blob/c02c7cf7b0f28c85466d284070322ab6baa2cd15/src/mochi/models/confirmable.cr#L66" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="confirmation_period_valid?-instance-method">
      <div class="signature">
        
        def <strong>confirmation_period_valid?</strong>

        <a class="method-permalink" href="#confirmation_period_valid?-instance-method">#</a>
      </div>
      
        <div class="doc">
          
          <p>Checks if the confirmation for the user is within the limit time.
We do this by calculating if the difference between today and the
confirmation sent date does not exceed the confirm in time configured.
allow_unconfirmed_access_for is a model configuration, must always be an integer value.</p>

<p>Example:</p>

<ul><li><code>allow_unconfirmed_access_for = 1.day and confirmation_sent_at = today</code></li></ul></ul>

<pre><code><span class="s">`confirmation_period_valid?   # returns true`</span></code></pre>

<ul><li><code>allow_unconfirmed_access_for = 5.days and confirmation_sent_at = 4.days.ago</code></li></ul></ul>

<pre><code><span class="s">`confirmation_period_valid?   # returns true`</span></code></pre>

<ul><li><code>allow_unconfirmed_access_for = 5.days and confirmation_sent_at = 5.days.ago</code></li></ul></ul>

<pre><code><span class="s">`confirmation_period_valid?   # returns false`</span></code></pre>

<ul><li><code>allow_unconfirmed_access_for = 0.days</code></li></ul></ul>

<pre><code><span class="s">`confirmation_period_valid?   # will always return false`</span></code></pre>

<ul><li><code>allow_unconfirmed_access_for = nil</code></li></ul></ul>

<pre><code><span class="s">`confirmation_period_valid?   # will always return true`</span></code></pre>
        </div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/andrewc910/mochi/blob/c02c7cf7b0f28c85466d284070322ab6baa2cd15/src/mochi/models/confirmable.cr#L109" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="confirmation_required?-instance-method">
      <div class="signature">
        
        def <strong>confirmation_required?</strong>

        <a class="method-permalink" href="#confirmation_required?-instance-method">#</a>
      </div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/andrewc910/mochi/blob/c02c7cf7b0f28c85466d284070322ab6baa2cd15/src/mochi/models/confirmable.cr#L59" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="confirmed?-instance-method">
      <div class="signature">
        
        def <strong>confirmed?</strong>

        <a class="method-permalink" href="#confirmed?-instance-method">#</a>
      </div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/andrewc910/mochi/blob/c02c7cf7b0f28c85466d284070322ab6baa2cd15/src/mochi/models/confirmable.cr#L55" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="generate_confirmation_token-instance-method">
      <div class="signature">
        
        def <strong>generate_confirmation_token</strong>

        <a class="method-permalink" href="#generate_confirmation_token-instance-method">#</a>
      </div>
      
        <div class="doc">
          
          <p>Generates a new random token for confirmation, and stores
the value in <code>self.confirmation_token</code></p>
        </div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/andrewc910/mochi/blob/c02c7cf7b0f28c85466d284070322ab6baa2cd15/src/mochi/models/confirmable.cr#L45" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="generate_confirmation_token!-instance-method">
      <div class="signature">
        
        def <strong>generate_confirmation_token!</strong>

        <a class="method-permalink" href="#generate_confirmation_token!-instance-method">#</a>
      </div>
      
        <div class="doc">
          
          <p>Generates a new random token for confirmation, stores
the value in <code>self.confirmation_token</code> & then saves the user</p>
        </div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/andrewc910/mochi/blob/c02c7cf7b0f28c85466d284070322ab6baa2cd15/src/mochi/models/confirmable.cr#L51" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="send_confirmation_instructions-instance-method">
      <div class="signature">
        
        def <strong>send_confirmation_instructions</strong>

        <a class="method-permalink" href="#send_confirmation_instructions-instance-method">#</a>
      </div>
      
        <div class="doc">
          
          <p>Send a confirmation email.</p>

<p>Sets <code>self.confirmation_sent_at</code>
Examples:</p>

<ul><li><code>user<a href="../../Mochi/Models/Confirmable.html#send_confirmation_instructions-instance-method">.send_confirmation_instructions</a> # returns true/false</code></li></ul></ul>
        </div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/andrewc910/mochi/blob/c02c7cf7b0f28c85466d284070322ab6baa2cd15/src/mochi/models/confirmable.cr#L151" target="_blank">View source</a>]
        
      </div>
    </div>
  




</div>

</body>
</html>
